<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="imagens/logo-icon.png" type="image/x-icon">
    <link rel="stylesheet" href="css/styleSenha.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Nova Senha - NutriWeb</title>
</head>

<body>
    <header class="header">
        <section class="left-section">
            <a href="/"><img src="imagens/logo.png" alt="Logo" class="logo"></a>
            <a href="/ranking" class="ranking"><button class="ranking-button">Ranking</button></a>
            <a href="/profissionais"><button class="profissionais-button">Profissionais</button></a>
        </section>
    
        <section class="center-section">
            <form action="/buscar" method="GET" class="form-busca">
                <section class="input-premium">
                    <span class="material-icons search-icon md-24">search</span>
                    <input 
                        type="text" 
                        name="q" 
                        placeholder="Buscar publicações e nutricionistas..."
                        value="<%= typeof termo !== 'undefined' ? termo : '' %>"
                        minlength="2"
                        required
                    >
                    <button type="submit" style="display: none;"></button>
                </section>
            </form>
        </section>
        
        <section class="right-section">
            <% if (headerUsuario.estaLogado) { %>
                <a href="/premium"><button class="premium-button">Premium</button></a>
                
                <a href="<%= headerUsuario.urlPerfil %>" class="perfil-usuario-link">
                    <div class="perfil-usuario">
                        <img src="<%= headerUsuario.fotoPerfil %>" 
                             alt="Foto de perfil" 
                             class="foto-perfil-header"
                             onerror="this.src='imagens/foto_perfil.jpg'">
                        <span class="nome-usuario-header"><%= headerUsuario.nome %></span>
                    </div>
                </a>

                <a href="/logout" class="logout-link">
                    <span class="material-icons">logout</span>
                  </a>
            <% } else { %>
                <a href="/premium"><button class="premium-button">Premium</button></a>
                <a href="/login"><button class="entrar-button">Entrar</button></a>
            <% } %>
        </section>
    </header>

    <%
    let erroValidacao = { senha: "", confirmarSenha: "" };
    let msgErro = { senha: "", confirmarSenha: "" };

    if (listaErros) {
        listaErros.errors.forEach(function(erro) {
            if (erro.path == "senha") {
                erroValidacao.senha = "erro-form";
                msgErro.senha = erro.msg;
            }
            if (erro.path == "confirmarSenha") {
                erroValidacao.confirmarSenha = "erro-form";
                msgErro.confirmarSenha = erro.msg;
            }
        });
    }
    %>

    <section class="header-content">
        <a href="/login" class="back-button">
            <span class="material-icons arrow-icon">arrow_back_ios</span>
            <span class="back-arrow">Voltar</span>
        </a>
    </section>

    <section class="senha-container rSenha-container">
        <% if (tokenValido) { %>
            <section class="senha-card rSenha-card">
                <span class="material-icons">vpn_key</span>
                <h2>Nova Senha</h2>
                <p>Digite sua nova senha com segurança</p>
                
                <section id="password-requirements">
                    <span>A senha deve conter:</span>
                    <ul>
                        <li id="length" class="invalid">Pelo menos 8 caracteres</li>
                        <li id="uppercase" class="invalid">Pelo menos uma letra maiúscula</li>
                        <li id="lowercase" class="invalid">Pelo menos uma letra minúscula</li>
                        <li id="number" class="invalid">Pelo menos um número</li>
                        <li id="special" class="invalid">Pelo menos um caractere especial</li>
                    </ul>
                </section>
                
                <form method="post" action="/redefinir-senha">
                    <input type="hidden" name="token" value="<%= token %>">
                    
                    <input type="password" 
                        name="senha" 
                        id="senha" 
                        class="<%= erroValidacao.senha %>" 
                        placeholder="Nova senha"
                        minlength="6"
                        required>
                    <% if (msgErro.senha) { %>
                        <span class="erro-mensagem"><%= msgErro.senha %></span>
                    <% } %>
                    
                    <input type="password" 
                        name="confirmarSenha" 
                        id="confirmarSenha" 
                        class="<%= erroValidacao.confirmarSenha %>" 
                        placeholder="Confirmar nova senha"
                        minlength="6"
                        required>
                    <% if (msgErro.confirmarSenha) { %>
                        <span class="erro-mensagem"><%= msgErro.confirmarSenha %></span>
                    <% } %>
                    
                    <input type="submit" value="Alterar Senha" class="btn-entrar">
                </form>

                <div class="or-divider">Ou</div>

                <div class="senha-actions">
                    <a href="/login"><button>Voltar para o Login</button></a>
                </div>
            </section>

        <% } else { %>
            <section class="senha-card invalido">
                <span class="material-icons">error_outline</span>
                <h2>Link Inválido</h2>
                <p>Este link de recuperação expirou ou já foi utilizado. Por favor, solicite um novo link de recuperação.</p>
                
                <div class="senha-actions" style="margin-top: 30px;">
                    <a href="/senha"><button>Solicitar Novo Link</button></a>
                    <a href="/login"><button>Voltar para o Login</button></a>
                </div>
            </section>
        <% } %>

        <section class="side-image rSide-image">
            <img src="imagens/img-login.jpg" alt="Nova Senha">
        </section>
    </section>

    <section class="mobile">
        <section class="menu">
            <section class="left-section">
                <a href="/"><img src="imagens/logo.png" alt="Logo" class="logo"></a>
            </section>
            <section class="right-section">
                <span class="material-icons search-icon md-24 menu-icon">menu</span>
            </section>
        </section>

        <section class="mobile-menu hidden">
            <ul>
                <li><a href="/ranking">Ranking</a></li>
                <li><a href="/profissionais">Profissionais</a></li>
                <li><a href="/premium">Premium</a></li>
                <li><a href="/login">Entrar</a></li>
            </ul>
        </section>
    </section>

    <footer class="footer-mobile">
        <section class="footer-container">
            <section class="footer-logo">
                <a href="/"><img src="imagens/logo.png" alt="Logo" class="logo"></a>
                <a href="/"><h3>NutriWeb</h3></a>
            </section>
            <section class="footer-informacao">
                <a href="/">Página Inicial</a>
                <a href="/ranking">Ranking</a>
                <a href="/profissionais">Profissionais</a>
                <a href="/premium">Premium</a>
                <a href="/login">Login</a>
            </section>
            <section class="footer-social">
                <p>Conecte-se com os melhores nutricionistas</p>
                <h3>Siga-nos</h3>
                <section class="social-icons">
                    <a href="https://www.instagram.com/nutriweb_oficial/"><i class="fab fa-instagram"></i></a>
                </section>
            </section>
        </section>
        <section class="footer-bottom">
            <p>&copy; 2024 NutriWeb. Todos os direitos reservados.</p>
        </section>
    </footer>

    <script src="js/segurancaForms.js"></script>
    <script src="js/indexMenu.js"></script>
    <script src="js/validacaotemporeal.js"></script>
    <script src="js/alerts.js"></script>
</body>
</html>