<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styleHeader.css">
    <link rel="stylesheet" href="css/styleBusca.css">
    <link rel="icon" href="imagens/logo-icon.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"rel="stylesheet">
    <title><%= termo ? `Resultados para "${termo}"` : 'Buscar' %> - NutriWeb</title>
</head>
<body>
    <%- include('../partials/header.ejs') %>

    <section class="home-mobile">
        <section class="menu">
            <section class="left-section">
                <a href="/"><img src="imagens/logo.png" alt="Logo" class="logo"></a>
            </section>
            <section class="right-section">
                <section class="material-icons search-icon md-24 menu-icon">menu</section>
            </section>
        </section>

        <section class="mobile-menu hidden">
            <ul>
                <li><a href="/perfilcliente">Meu Perfil</a></li>
                <li><a href="/ranking">Ranking</a></li>
                <li><a href="/profissionais">Profissionais</a></li>
                <li><a href="/premium">Premium</a></li>
                <li><a href="/login">Entrar</a></li>
            </ul>
        </section>
    </section>

    <main class="main-busca">
        <section class="container-busca">
            <% if (termo && termo.length > 0) { %>
                <h1 class="titulo-busca">Resultados para "<%= termo %>"</h1>
                
                <% if (typeof erro !== 'undefined') { %>
                    <section class="erro-busca">
                        <p><%= erro %></p>
                    </section>
                <% } else if (resultados && resultados.totalResultados > 0) { %>
                    <section class="resumo-resultados">
                        <p><%= resultados.totalResultados %> resultado(s) encontrado(s)</p>
                    </section>

                    <% if (resultados.publicacoes && resultados.publicacoes.length > 0) { %>
                        <section class="secao-resultados">
                            <h2 class="titulo-secao">Publicações (<%= resultados.publicacoes.length %>)</h2>
                            <section class="lista-publicacoes">
                                <% resultados.publicacoes.forEach(pub => { %>
                                    <article class="item-publicacao">
                                        <section class="info-autor">
                                            <section class="perfil-foto-container-busca">
                                                <% if (pub.autor.fotoPerfil) { %>
                                                    <img src="<%= pub.autor.fotoPerfil %>" 
                                                         alt="<%= pub.autor.nome %>" 
                                                         class="foto-autor">
                                                <% } else { %>
                                                    <img src="imagens/foto_perfil.jpg" 
                                                         alt="<%= pub.autor.nome %>" 
                                                         class="foto-autor">
                                                <% } %>
                                                
                                                <% if (pub.autor.premium && pub.autor.premium.temPremium) { %>
                                                    <section class="selo-premium-star-busca">
                                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <circle cx="12" cy="12" r="11" fill="url(#goldGradientBusca<%= pub.id %>)"/>
                                                            <path d="M12 4L13.5 9H18.5L14.5 12L16 17L12 14L8 17L9.5 12L5.5 9H10.5L12 4Z"
                                                                fill="white"
                                                                stroke="white"
                                                                stroke-width="0.5"/>
                                                            <defs>
                                                                <linearGradient id="goldGradientBusca<%= pub.id %>" x1="0%" y1="0%" x2="100%" y2="100%">
                                                                    <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                                                                    <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
                                                                </linearGradient>
                                                            </defs>
                                                        </svg>
                                                    </section>
                                                <% } %>
                                            </section>
                                            
                                            <section class="nome-autor">
                                                <a href="/perfilnutri?id=<%= pub.autor.id %>"><%= pub.autor.nome %></a>
                                            </section>
                                        </section>
                                        
                                        <section class="conteudo-publicacao">
                                            <section class="categoria-avaliacao">
                                                <section class="categoria"><%= pub.categoria %></section>
                                                <section class="avaliacao">⭐ <%= pub.mediaEstrelas %></section>
                                            </section>
                                            
                                            <% if (pub.resumo) { %>
                                                <p class="resumo-publicacao"><%= pub.resumo %></p>
                                            <% } %>
                                            
                                            <% if (pub.temFoto) { %>
                                                <section class="indicador-foto">Contém imagem</section>
                                            <% } %>
                                        </section>
                                    </article>
                                <% }); %>
                            </section>
                        </section>
                    <% } %>

                    <% if (resultados.nutricionistas && resultados.nutricionistas.length > 0) { %>
                        <section class="secao-resultados">
                            <h2 class="titulo-secao">Nutricionistas (<%= resultados.nutricionistas.length %>)</h2>
                            <section class="lista-nutricionistas">
                                <% resultados.nutricionistas.forEach(nut => { %>
                                    <article class="item-nutricionista">
                                        <section class="perfil-foto-container-busca-nutri">
                                            <% if (nut.fotoPerfil) { %>
                                                <img src="<%= nut.fotoPerfil %>" 
                                                     alt="<%= nut.nome %>" 
                                                     class="foto-nutricionista">
                                            <% } else if (nut.nutricionistaId >=0 && nut.nutricionistaId <= 36) { %>
                                                <img src="imagens/profissional<%= nut.nutricionistaId %>.png" 
                                                     alt="<%= nut.nome %>" 
                                                     class="foto-nutricionista">
                                            <% } else { %>
                                                <img src="imagens/foto_perfil.jpg" 
                                                     alt="<%= nut.nome %>" 
                                                     class="foto-nutricionista">
                                            <% } %>
                                            
                                            <% if (nut.premium && nut.premium.temPremium) { %>
                                                <section class="selo-premium-star-busca-nutri">
                                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <circle cx="12" cy="12" r="11" fill="url(#goldGradientNutri<%= nut.nutricionistaId %>)"/>
                                                        <path d="M12 4L13.5 9H18.5L14.5 12L16 17L12 14L8 17L9.5 12L5.5 9H10.5L12 4Z"
                                                            fill="white"
                                                            stroke="white"
                                                            stroke-width="0.5"/>
                                                        <defs>
                                                            <linearGradient id="goldGradientNutri<%= nut.nutricionistaId %>" x1="0%" y1="0%" x2="100%" y2="100%">
                                                                <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                                                                <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
                                                            </linearGradient>
                                                        </defs>
                                                    </svg>
                                                </section>
                                            <% } %>
                                        </section>
                                        
                                        <section class="info-nutricionista">
                                            <h3 class="nome-nutricionista">
                                                <a href="<%= nut.url %>"><%= nut.nome %></a>
                                            </h3>
                                            
                                            <% if (nut.razaoSocial) { %>
                                                <p class="razao-social"><%= nut.razaoSocial %></p>
                                            <% } %>
                                            
                                            <p class="especializacoes">Nutrição <%= nut.especializacoes %></p>
                                            <p class="localizacao">📍 <%= nut.localizacao %></p>
                                            
                                            <section class="estatisticas">
                                                <section class="avaliacao">⭐ <%= nut.mediaAvaliacoes %></section>
                                                <section class="publicacoes">📝 <%= nut.totalPublicacoes %> publicações</section>
                                            </section>
                                            
                                            <% if (nut.sobreMim) { %>
                                                <p class="sobre-mim"><%= nut.sobreMim.substring(0, 100) %><%= nut.sobreMim.length > 100 ? '...' : '' %></p>
                                            <% } %>
                                        </section>
                                    </article>
                                <% }); %>
                            </section>
                        </section>
                    <% } %>
                <% } else { %>
                    <section class="sem-resultados">
                        <h2>Nenhum resultado encontrado</h2>
                        <p>Não encontramos nada para "<%= termo %>"</p>
                        <section class="dicas-busca">
                            <h3>Dicas para uma busca melhor:</h3>
                            <ul>
                                <li>Verifique a ortografia</li>
                                <li>Use termos mais gerais</li>
                                <li>Tente sinônimos ou palavras relacionadas</li>
                            </ul>
                        </section>
                    </section>
                <% } %>
            <% } else { %>
                <section class="busca-inicial">
                    <h1>Buscar</h1>
                    <p>Use a barra de busca acima para encontrar publicações e nutricionistas</p>
                    
                    <section class="sugestoes-busca">
                        <h3>Sugestões populares:</h3>
                        <section class="tags-sugestoes">
                            <a href="/buscar?q=diabetes" class="tag-sugestao">diabetes</a>
                            <a href="/buscar?q=emagrecimento" class="tag-sugestao">emagrecimento</a>
                            <a href="/buscar?q=proteína" class="tag-sugestao">proteína</a>
                            <a href="/buscar?q=vegetariano" class="tag-sugestao">vegetariano</a>
                        </section>
                    </section>
                </section>
            <% } %>
        </section>
    </main>

    <footer class="footer-desktop">
        <section class="footer-container">
            <section class="footer-logo">
                <a href="/"><img src="imagens/logo.png" alt="Logo" class="logo"></a>
                <a href="/"><h3>NutriWeb</h3></a>
            </section>

          <section class="footer-informacao">
            <a href="/">Página Inicial</a>
            <a href="/ranking">Ranking</a>
            <a href="/profissionais">Profissionais</a>
            <a href="/premium">Premium</a>
            <a href="/login">Login</a>
            <a href="/">Sobre nós</a> 
            <a href="/tipoNutri">Como escolher o profissional ideal?</a>
          </section>
      
          <section class="footer-social">
            <p>Conecte-se com os melhores nutricionistas e encontre o profissional ideal para você.</p>
            <h3>Siga-nos</h3>
                <section class="social-icons">
                <a href="https://www.instagram.com/nutriweb_oficial/"><i class="fab fa-instagram"></i></a>
                </section>
          </section>
        </section>
        
        <section class="footer-bottom">
          <p>&copy; 2024 NutriWeb. Todos os direitos reservados.</p>
        </section>
    </footer>
    <script src="js/segurancaForms.js"></script>
    <script src="js/indexMenu.js"></script>
    <script src="js/alerts.js"></script>
</body>
</html>